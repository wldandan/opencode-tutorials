# TalkPro 测试指南

## 环境准备

### 1. 确保后端服务正常运行

```bash
cd backend
source .venv/bin/activate
python run.py
```

检查：
- 访问 http://localhost:8000/health 应该返回 {"status": "healthy"}
- 访问 http://localhost:8000/docs 查看 API 文档

### 2. 确保前端服务正常运行

```bash
cd frontend
npm run dev
```

检查：
- 访问 http://localhost:3000 应该显示首页
- 浏览器控制台没有错误

### 3. 配置 Claude API Key

确保 `backend/.env` 文件中包含有效的 API Key：
```
ANTHROPIC_API_KEY=sk-ant-xxxxx
```

---

## 功能测试

### 测试 1: 健康检查

**目的**: 验证后端服务正常启动

```bash
curl http://localhost:8000/health
```

**预期结果**:
```json
{"status": "healthy", "app": "TalkPro"}
```

---

### 测试 2: 获取题目列表

**目的**: 验证算法题库加载正常

```bash
curl http://localhost:8000/api/algorithm/questions
```

**预期结果**:
```json
[
  {"id": "q-001", "title": "两数之和", "difficulty": "easy"},
  ...
]
```

---

### 测试 3: 获取场景列表

**目的**: 验证系统设计场景加载正常

```bash
curl http://localhost:8000/api/system-design/scenarios
```

**预期结果**:
```json
[
  {"id": "s-001", "title": "设计微博 Feed 流", "description": "..."},
  ...
]
```

---

### 测试 4: 算法面试流程

**目的**: 验证完整的算法面试流程

**步骤**:

1. 打开浏览器访问 http://localhost:3000
2. 点击"算法面试"卡片
3. 选择难度（如"中等"）
4. 点击"开始面试"
5. 等待 AI 出题（应该看到题目内容）
6. 输入答案（如："我可以用哈希表来解决"）
7. 点击"发送"
8. 观察 AI 的追问（应该看到流式响应）
9. 继续对话 2-3 轮
10. 点击"结束面试"
11. 查看评估报告

**预期结果**:
- ✅ 题目正确显示
- ✅ AI 追问相关且深入
- ✅ 流式响应流畅
- ✅ 评估报告包含 5 个维度评分
- ✅ 有改进建议

**常见问题**:
- ❌ 如果题目不显示：检查后端日志，确认 questions.json 加载成功
- ❌ 如果 AI 无响应：检查 API Key 是否有效
- ❌ 如果 WebSocket 断开：查看浏览器控制台和后端日志

---

### 测试 5: 系统设计流程

**目的**: 验证完整的系统设计流程

**步骤**:

1. 返回首页
2. 点击"系统设计"卡片
3. 选择场景（如"设计微博 Feed 流"）
4. 查看场景描述和需求
5. 输入设计方案（如："我会用推拉结合的方式..."）
6. 观察 AI 的引导和挑战
7. 继续讨论 3-5 轮
8. 点击"结束讨论"
9. 查看评估报告

**预期结果**:
- ✅ 场景信息正确显示
- ✅ AI 引导有逻辑性
- ✅ 挑战有深度
- ✅ 评估报告包含 6 个维度评分
- ✅ 有优点和改进建议

---

### 测试 6: WebSocket 连接

**目的**: 验证 WebSocket 流式响应正常

**浏览器控制台测试**:

1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签
3. 选择 WS（WebSocket）过滤器
4. 开始一个面试
5. 观察 WebSocket 连接

**预期结果**:
- ✅ WebSocket 状态为 101 Switching Protocols
- ✅ 能够看到发送和接收的消息
- ✅ 消息类型包含：message_start, message_chunk, message_complete

---

### 测试 7: 边界情况

**目的**: 验证异常情况处理

**测试用例**:

1. **空输入**
   - 不输入任何内容点击发送
   - **预期**: 按钮禁用或提示错误

2. **快速连续发送**
   - 连续快速点击发送
   - **预期**: 应该正常处理，不会丢失消息

3. **刷新页面**
   - 面试中刷新页面
   - **预期**: 会话丢失，返回首页（预期行为）

4. **无效 session ID**
   - 手动修改 WebSocket URL
   - **预期**: 显示错误提示

---

## 性能测试

### 测试 8: 响应时间

**测试指标**:

1. **首次响应时间**
   - 从点击"开始面试"到显示题目
   - **预期**: < 2 秒

2. **流式响应延迟**
   - 从发送消息到收到第一个字符
   - **预期**: < 2 秒

3. **页面加载时间**
   - 从输入 URL 到页面完全渲染
   - **预期**: < 1 秒

---

## 兼容性测试

### 浏览器兼容性

**推荐浏览器**:
- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

**测试方法**:
在不同浏览器中运行上述测试用例

---

## Bug 修复清单

### 已知问题

1. **WebSocket 自动重连**
   - 当前：断开后不自动重连
   - 影响：网络波动时用户体验差
   - 优先级：P2（后续版本）

2. **会话持久化**
   - 当前：刷新页面会话丢失
   - 影响：用户可能意外丢失进度
   - 优先级：P1（第二版本）

3. **代码编辑器**
   - 当前：只支持纯文本输入
   - 影响：用户体验不佳
   - 优先级：P2（后续版本）

---

## 测试报告模板

完成测试后，填写此报告：

```markdown
## 测试日期: YYYY-MM-DD

### 测试环境
- 后端版本: 0.1.0
- 前端版本: 0.1.0
- Python 版本: 3.x.x
- Node.js 版本: 18.x.x
- 浏览器: Chrome xxx

### 测试结果

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 健康检查 | ✅/❌ | |
| 获取题目 | ✅/❌ | |
| 算法面试流程 | ✅/❌ | |
| 系统设计流程 | ✅/❌ | |
| WebSocket | ✅/❌ | |
| 边界情况 | ✅/❌ | |

### 发现的问题
1. ...
2. ...

### 建议
1. ...
2. ...
```

---

## 自动化测试（未来）

### 计划添加

- [ ] 单元测试（pytest）
- [ ] API 集成测试
- [ ] 前端组件测试
- [ ] E2E 测试（Playwright）

---

*测试指南 v1.0 - 2026-01-25*
