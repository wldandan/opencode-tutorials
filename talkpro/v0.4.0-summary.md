# TalkPro v0.4.0 - 职场场景训练

## 版本概述

v0.4.0 为 TalkPro 添加了职场场景训练功能，模拟真实的职场场景（晋升答辩、方案宣讲、故障复盘），帮助用户提升职场沟通和应对能力。

**发布日期**: 2025-01-25
**Git提交**: b380133

---

## 核心功能

### 1. 职场场景训练 (`/workplace`)

**功能描述**: 模拟真实的职场场景，用户与AI扮演的不同角色进行对话，提升职场应对能力。

**场景列表**:

#### 1.1 晋升答辩 - P5升P6
- **角色**: 技术总监
- **重点**: 技术深度和问题解决能力
- **考察维度**:
  - 技术深度：是否理解技术原理，能否解决复杂问题
  - 业务理解：是否理解业务需求，技术方案能否支撑业务
  - 团队协作：是否具备团队影响力，能否推动团队建设
  - 学习能力：是否有持续学习和成长的能力
- **问题类型**:
  - 质疑项目贡献度和真实性
  - 深入挖掘技术细节
  - 询问遇到的困难和解决方案
  - 询问团队影响力

#### 1.2 晋升答辩 - P6升P7
- **角色**: CTO/技术VP
- **重点**: 影响力和领导力
- **考察维度**:
  - 技术影响力：是否在技术社区有影响力
  - 业务价值：是否为公司创造了显著的业务价值
  - 领导力：是否能够带领团队攻克难关
  - 战略思维：是否能够从战略角度思考技术规划
- **问题类型**:
  - 技术战略和路线图
  - 行业影响力
  - 重大技术突破
  - 技术人才梯队培养

#### 1.3 技术方案宣讲
- **角色**: 多角色（产品经理、测试负责人、其他团队开发、技术总监）
- **场景**: 将单体应用拆分为微服务架构
- **考察重点**: 应对多方质疑，协调不同利益
- **多角色挑战**:
  - **产品经理**: 质疑需求价值、投入产出比
  - **测试负责人**: 质疑测试成本、稳定性、回滚方案
  - **其他团队开发**: 质疑兼容性、API变更、数据迁移
  - **技术总监**: 质疑时间线、人力资源、延期风险

#### 1.4 故障复盘会
- **角色**: 故障调查组组长
- **场景**: 生产环境OOM导致服务不可用30分钟
- **考察重点**: 问题分析能力和责任担当
- **问题类型**:
  - 5个为什么分析法挖掘根因
  - 质疑应急响应是否到位
  - 评估改进措施是否有效
  - 追问监控告警是否完善
  - 质疑应急预案是否可行

---

## 技术实现

### 后端架构

#### 2.1 WorkplaceAgent

**文件**: `backend/app/agents/workplace_agent.py`

**核心功能**:
- 场景定义和管理
- 角色人格设定（persona）
- 对话生成逻辑
- 评估报告生成

**关键技术**:
```python
class WorkplaceAgent:
    - get_scenarios(): 获取所有场景
    - start_interview(): 开始面试，生成开场问题
    - chat(): 继续对话，基于角色人格回复
    - end_interview(): 生成评估报告（JSON格式）
```

**角色人格示例**:
```python
persona = """你是一位经验丰富的技术总监，正在主持P5工程师晋升P6的答辩会。
你关注候选人的：
- 技术深度：是否理解技术原理，能否解决复杂问题
- 业务理解：是否理解业务需求，技术方案能否支撑业务
- 团队协作：是否具备团队影响力，能否推动团队建设
- 学习能力：是否有持续学习和成长的能力

你会提出挑战性问题，质疑候选人的回答，深入挖掘细节。
如果候选人的回答过于表面，你会追问"为什么"、"具体怎么做"、"遇到过什么问题"。"""
```

#### 2.2 API Endpoints

**文件**: `backend/app/api/workplace_v2.py`

| 端点 | 方法 | 功能 | 认证 |
|------|------|------|------|
| `/workplace/v2/scenarios` | GET | 获取所有场景列表 | 是 |
| `/workplace/v2/interview` | POST | 开始职场场景面试 | 是 |
| `/workplace/v2/:id/ws` | WS | WebSocket实时对话 | 是 |
| `/workplace/v2/:id/end` | POST | 结束面试并获取评估 | 是 |

**WebSocket消息格式**:
```json
// Client -> Server
{"type": "message", "content": "用户的回答"}
{"type": "end"}

// Server -> Client
{"type": "message_start", "role": "assistant"}
{"type": "message_chunk", "content": "回复片段"}
{"type": "message_complete", "content": "完整回复", "role": "技术总监"}
{"type": "session_complete", "evaluation": {...}}
{"type": "error", "message": "错误信息"}
```

#### 2.3 数据模型更新

**文件**: `backend/app/models/session.py`

添加了新的SessionType:
```python
class SessionType(str, enum.Enum):
    ALGORITHM = "algorithm"
    SYSTEM_DESIGN = "system_design"
    WORKPLACE = "workplace"  # 新增
```

### 前端实现

#### 3.1 WorkplacePage

**文件**: `frontend/src/pages/WorkplacePage.tsx`

**功能模块**:

**场景选择界面**:
- 4个场景卡片展示
- 场景名称、描述、角色介绍
- 点击开始训练

**对话界面**:
- 实时消息流式显示
- 显示当前AI角色（技术总监、CTO等）
- 用户输入和发送
- 结束训练按钮

**评估报告展示**:
- 四个维度评分（技术深度、业务理解、沟通表达、逻辑思维）
- 评分颜色区分（红/黄/绿）
- 优点列表
- 改进建议列表
- 总体反馈

**视觉设计**:
- 绿色主题色（区别于算法蓝色、系统设计紫色）
- 场景信息面板
- 提示和技巧说明

#### 3.2 API集成

**文件**: `frontend/src/services/api.ts`

```typescript
export async function startWorkplaceInterview(token: string, scenario: string)
export function createWorkplaceWebSocket(sessionId: string, token: string): WebSocket
export async function endWorkplaceInterview(token: string, sessionId: string)
```

#### 3.3 路由更新

**文件**: `frontend/src/App.tsx`

添加新路由:
```typescript
<Route path="/workplace" element={<WorkplacePage />} />
```

#### 3.4 HomePage更新

**文件**: `frontend/src/pages/HomePage.tsx`

**变化**:
- 训练类型选择从2列改为3列
- 添加职场场景训练卡片（绿色主题）
- 更新max-width从max-w-4xl到max-w-6xl

**卡片设计**:
```tsx
<Link to="/workplace" className="group">
  <div className="bg-white rounded-lg shadow-lg p-8">
    <h3>职场场景</h3>
    <p>模拟晋升答辩、方案宣讲等真实职场场景</p>
    <ul>
      <li>✓ 晋升答辩模拟</li>
      <li>✓ 方案宣讲演练</li>
      <li>✓ 故障复盘训练</li>
    </ul>
  </div>
</Link>
```

#### 3.5 HistoryPage更新

**文件**: `frontend/src/pages/HistoryPage.tsx`

**新增**:
- filter类型添加'workplace'
- 添加"职场场景"筛选按钮（绿色主题）
- getTypeLabel函数处理workplace类型

```typescript
const getTypeLabel = (type: string) => {
  const labels = {
    algorithm: '算法面试',
    system_design: '系统设计',
    workplace: '职场场景',  // 新增
  };
  return labels[type as keyof typeof labels] || type;
};
```

---

## 评估系统

### 评分维度

职场场景训练评估4个维度（0-10分）:

1. **技术深度** (technical_depth)
   - 技术原理理解
   - 问题解决能力
   - 技术决策合理性

2. **业务理解** (business_understanding)
   - 业务需求把握
   - 技术与业务平衡
   - 业务价值创造

3. **沟通表达** (communication)
   - 表达清晰度
   - 逻辑条理性
   - 应对质疑的能力

4. **逻辑思维** (logical_thinking)
   - 分析问题能力
   - 根因挖掘深度
   - 解决方案可行性

### 评估报告格式

```json
{
  "technical_depth": 7.5,
  "business_understanding": 8.0,
  "communication": 7.0,
  "logical_thinking": 8.5,
  "overall": 7.75,
  "strengths": [
    "回答问题有条理",
    "技术思路清晰",
    "能够应对质疑"
  ],
  "improvements": [
    "可以更深入地分析问题",
    "可以提供更多具体实例",
    "加强业务价值量化说明"
  ],
  "feedback": "表现良好，建议继续加强技术深度和业务理解，在回答问题时多结合具体项目经验。"
}
```

---

## 用户体验设计

### 视觉层次

**三级训练类型**:
1. 算法面试 - 蓝色 (indigo)
2. 系统设计 - 紫色 (purple)
3. 职场场景 - 绿色 (green)

**场景信息面板**:
- 场景名称
- 角色身份
- 消息数量
- 提示和技巧

### 交互流程

```
选择场景
  ↓
阅读场景说明和角色介绍
  ↓
点击"开始"
  ↓
AI角色开场提问
  ↓
用户回答
  ↓
AI角色追问/挑战（多轮对话）
  ↓
用户点击"结束训练"
  ↓
生成评估报告
  ↓
查看得分、优点、改进建议
  ↓
选择"重新开始"或"返回首页"
```

### AI角色扮演特点

**真实性**:
- 基于真实职场场景设计
- 角色性格鲜明（技术总监严厉、产品经理关注价值）
- 多角度质疑和挑战

**针对性**:
- 每个场景有明确的考察重点
- 问题层层递进，挖掘深度
- 不会泛泛而谈

**建设性**:
- 认可好的做法
- 指出具体不足
- 提供可操作的改进建议

---

## 使用场景示例

### 场景1：晋升准备

> "我要参加P6升P7的晋升答辩，但不知道评委们会问什么问题。我想先模拟练习一下，看看自己的准备是否充分。"

**使用流程**:
1. 选择"晋升答辩 - P6升P7"场景
2. 阅读场景说明，了解CTO会关注什么
3. 开始模拟，CTO提出挑战性问题
4. 回答关于技术影响力、领导力、战略思维的问题
5. 查看评估报告，了解自己的优势和不足
6. 针对改进建议进行准备

### 场景2：方案宣讲准备

> "我要向团队宣讲微服务拆分方案，但担心被挑战。想先模拟一下，看看可能会遇到什么质疑。"

**使用流程**:
1. 选择"技术方案宣讲"场景
2. 了解会有多角色参与（产品、测试、其他团队、技术总监）
3. AI随机切换角色，从不同角度挑战方案
4. 练习如何回应不同角色的质疑
5. 评估自己的沟通表达和逻辑思维

### 场景3：故障复盘

> "线上出了OOM故障，我需要在复盘会上分析根因和改进措施。担心自己分析不够深入。"

**使用流程**:
1. 选择"故障复盘会"场景
2. 故障调查组组长不断追问"为什么"
3. 练习根因分析方法（5个为什么）
4. 评估改进措施是否有效
5. 提升问题分析能力和责任意识

---

## 技术亮点

### 1. 多角色AI扮演

**动态角色切换**:
```python
# 场景定义时设置角色
"role": "多角色（产品经理、测试负责人、其他团队开发）"

# 对话时AI自动切换角色
# 可能这一轮是产品经理质疑价值
# 下一轮是测试负责人质疑可行性
```

### 2. 5个为什么分析法

**根因挖掘**:
- 不断追问"为什么"
- 表面原因 → 直接原因 → 根本原因
- 评估用户分析的深度

### 3. 评估报告生成

**JSON解析**:
```python
# 使用正则表达式提取JSON
json_match = re.search(r'\{.*\}', response, re.DOTALL)
evaluation = json.loads(json_match.group(0))

# 确保所有字段存在
evaluation.setdefault("technical_depth", 7)
evaluation.setdefault("business_understanding", 7)
...
```

**容错处理**:
- 如果JSON解析失败，返回默认评估
- 确保前端总是能拿到有效数据

---

## 测试建议

### 手动测试清单

#### 场景选择
- [ ] 场景列表正确显示4个场景
- [ ] 场景描述清晰易懂
- [ ] 角色介绍准确

#### 对话流程
- [ ] 开场问题符合场景设定
- [ ] AI角色正确显示
- [ ] 消息流式显示正常
- [ ] 用户可以发送消息
- [ ] 追问有深度和针对性

#### 评估报告
- [ ] 四个维度都有评分
- [ ] 优点列表基于对话内容
- [ ] 改进建议可操作
- [ ] 总体反馈建设性

#### 异常处理
- [ ] WebSocket断开后重连
- [ ] 网络错误时显示友好提示
- [ ] 评估失败时使用默认值

---

## 已知问题和限制

### 1. 场景内容固定
- **问题**: 4个场景是预定义的，不能自定义
- **影响**: 用户不能模拟自己的实际场景
- **未来**: 支持用户上传场景描述

### 2. 评估客观性
- **问题**: AI评估可能不够客观
- **影响**: 评分可能偏高或偏低
- **缓解**: 基于对话内容生成评估，相对客观

### 3. 语音输入
- **问题**: 目前只支持文字输入
- **影响**: 无法练习口头表达
- **未来**: 集成语音识别和合成

---

## 未来增强

### v0.5.0 计划

1. **场景扩展**
   - 绩效面谈模拟
   - 跨团队协作沟通
   - 技术分享演讲
   - 架构评审会议

2. **功能增强**
   - 用户自定义场景
   - 对话录制和回放
   - AI语气和情绪分析
   - 同行评审功能

3. **评估优化**
   - 多维度雷达图
   - 与历史记录对比
   - 改进趋势追踪
   - 个性化训练建议

---

## 学习价值

### 用户收益

1. **降低真实场景风险**
   - 提前模拟练习
   - 发现潜在问题
   - 完善应对策略

2. **提升职场软技能**
   - 沟通表达能力
   - 逻辑思维能力
   - 应对质疑能力
   - 业务理解能力

3. **增强自信心**
   - 熟悉场景流程
   - 准备充分
   - 减少紧张感

### 适用人群

- **初级工程师**: 准备晋升答辩
- **中级工程师**: 提升方案宣讲能力
- **高级工程师**: 锻炼领导力和影响力
- **技术Leader**: 练习架构决策和危机处理

---

## 总结

v0.4.0 职场场景训练为TalkPro增加了第三个训练维度，完善了产品矩阵：

| 训练类型 | 颜色 | 核心能力 | v0.1.0 | v0.2.0 | v0.3.0 | v0.4.0 |
|---------|------|----------|--------|--------|--------|--------|
| 算法面试 | 蓝色 | 技术深度 | ✅ | ✅ | ✅ | ✅ |
| 系统设计 | 紫色 | 架构能力 | ✅ | ✅ | ✅ | ✅ |
| 职场场景 | 绿色 | 软技能 | ❌ | ❌ | ❌ | ✅ |

**完整能力培养体系**:
- 硬技能：算法、系统设计
- 软技能：沟通、表达、逻辑、业务理解

TalkPro现在能够全面培养工程师的面试和职场能力！

---

**版本**: v0.4.0
**状态**: ✅ 已完成
**下一版本**: v0.5.0 - 场景扩展和功能增强
