# TalkPro v0.2.0 - User Authentication & History Persistence

## Overview

Version 0.2.0 adds user authentication and training history persistence to TalkPro while maintaining backward compatibility with the original no-auth experience.

## What's New

### Backend Features (Commit: ca333a6)

#### 1. User Authentication System
- **User Model**: Extended with authentication fields
  - Email (unique, indexed)
  - Password hash (bcrypt)
  - Profile fields: name, years_of_experience, current_company, current_role, target_role

- **Security Module** (`backend/app/core/security.py`)
  - Password hashing with bcrypt
  - JWT token generation and validation
  - Token expiration: 24 hours
  - HS256 algorithm with secret key

- **Authentication APIs** (`backend/app/api/auth.py`)
  - `POST /api/auth/register` - User registration with email validation
  - `POST /api/auth/login` - Login with JWT token generation
  - `GET /api/auth/me` - Get current user (protected)
  - `PUT /api/auth/me` - Update user profile (protected)

#### 2. Training History Persistence
- **History APIs** (`backend/app/api/history.py`)
  - `GET /api/history` - List user's training sessions
    - Pagination support (skip, limit)
    - Filter by type (algorithm/system_design)
    - Ordered by created_at desc
  - `GET /api/history/:id` - Get session details with messages
  - `DELETE /api/history/:id` - Delete session

#### 3. Version 2 APIs with Authentication
All interview endpoints now have v2 versions that require authentication:
- `POST /api/algorithm/v2/interview` - Start algorithm interview (authenticated)
- `WS /api/algorithm/v2/:sessionId/ws` - Algorithm WebSocket (authenticated)
- `POST /api/algorithm/v2/:sessionId/end` - End algorithm interview (authenticated)
- `POST /api/system-design/v2/interview` - Start system design interview (authenticated)
- `WS /api/system-design/v2/:sessionId/ws` - System Design WebSocket (authenticated)
- `POST /api/system-design/v2/:sessionId/end` - End system design interview (authenticated)

**Key Features:**
- JWT authentication via `Authorization: Bearer <token>` header
- WebSocket authentication via query parameter: `?token=<token>`
- Sessions automatically associated with logged-in user
- Ownership verification on session access

#### 4. Configuration Updates
- JWT settings in `backend/app/config.py`
  - `secret_key`: Loaded from environment variable
  - `algorithm`: HS256
  - `access_token_expire_minutes`: 1440 (24 hours)

#### 5. Dependencies Added
- `python-jose[cryptography]==3.3.0` - JWT handling
- `passlib[bcrypt]==1.7.4` - Password hashing
- `email-validator==2.1.0` - Email validation

### Frontend Features (Commit: 8d9c42d)

#### 1. Authentication Pages
- **LoginPage** (`frontend/src/pages/LoginPage.tsx`)
  - Email/password form
  - Error handling and display
  - Automatic redirect after successful login
  - Link to registration page
  - Returns to home if cancelled

- **RegisterPage** (`frontend/src/pages/RegisterPage.tsx`)
  - Name, email, password, confirm password fields
  - Form validation:
    - Name: minimum 2 characters
    - Email: valid format
    - Password: minimum 8 characters, must contain letters and numbers
    - Confirm password: must match password
  - Link to login page
  - Automatic login and redirect after registration

- **ProfilePage** (`frontend/src/pages/ProfilePage.tsx`)
  - Display user profile information
  - Edit mode for updating profile fields:
    - Name
    - Years of experience
    - Current company
    - Current role
    - Target role
  - Account info section (email, registration date)
  - Logout functionality
  - Navigate back to home

#### 2. State Management
- **AuthStore** (`frontend/src/stores/authStore.ts`)
  - Zustand store with persist middleware
  - State: user, token, isAuthenticated
  - Actions: setAuth, logout, setUser
  - Automatic persistence to localStorage

- **Form Stores** (`frontend/src/stores/formStore.ts`)
  - `useLoginFormStore`: Email and password state
  - `useRegisterFormStore`: Name, email, password, confirm password state

#### 3. Protected Routes
- **ProtectedRoute Component** (`frontend/src/components/ProtectedRoute.tsx`)
  - Wraps routes that require authentication
  - Redirects to /login if not authenticated

#### 4. API Integration
- **Authentication APIs** (`frontend/src/services/api.ts`)
  - `register(name, email, password)`
  - `login(email, password)`
  - `getCurrentUser(token)`
  - `updateUserProfile(token, updates)`

- **History APIs**
  - `getTrainingHistory(token, skip, limit, type)`
  - `getSessionDetail(token, sessionId)`
  - `deleteSession(token, sessionId)`

- **Interview APIs (v1 and v2)**
  - v1: No authentication (backward compatible)
  - v2: Requires authentication token
  - Algorithm interview APIs
  - System design interview APIs
  - WebSocket connection functions

#### 5. UI Integration
- **HomePage Updates**
  - Shows different options based on authentication status:
    - Not authenticated: Login and Register buttons
    - Authenticated: Welcome message, Profile link, Logout button
  - Maintains original design and layout

- **AlgorithmPage Updates**
  - Automatically detects authentication status
  - Uses v2 APIs if authenticated, v1 if not
  - Sessions persist to user account when logged in
  - No changes to UI or user flow

- **SystemDesignPage Updates**
  - Automatically detects authentication status
  - Uses v2 APIs if authenticated, v1 if not
  - Sessions persist to user account when logged in
  - No changes to UI or user flow

#### 6. Routing Updates
- New routes added to `frontend/src/App.tsx`:
  - `/login` - LoginPage
  - `/register` - RegisterPage
  - `/profile` - ProfilePage

## Backward Compatibility

**Important**: v0.2.0 maintains full backward compatibility with v0.1.0:

- Users can still practice interviews WITHOUT logging in
- Unauthenticated users use v1 APIs (no token required)
- Sessions are not persisted for unauthenticated users
- When users log in, their sessions are automatically saved to their account

## Architecture Decisions

### 1. Dual API Versioning
- **v1 APIs**: No authentication required, sessions in-memory only
- **v2 APIs**: JWT authentication required, sessions persisted to database
- **Benefit**: Gradual migration path, no forced authentication

### 2. Client-Side Auth Detection
- Frontend automatically detects `isAuthenticated` state
- Uses appropriate API version based on auth status
- **Benefit**: Seamless user experience, no code duplication

### 3. WebSocket Authentication
- Token passed via query parameter: `?token=<token>`
- Validated on connection using `get_current_user` dependency
- **Benefit**: Real-time features work with authentication

### 4. Password Requirements
- Minimum 8 characters
- Must contain letters and numbers
- **Rationale**: Balance between security and user convenience

## Testing

### Manual Testing Checklist

#### Authentication
- [ ] Register new account
- [ ] Login with valid credentials
- [ ] Login with invalid credentials (error handling)
- [ ] Logout functionality
- [ ] Profile page displays correctly
- [ ] Profile updates work
- [ ] Password validation on register

#### Interview Sessions (Authenticated)
- [ ] Start algorithm interview while logged in
- [ ] Complete algorithm interview
- [ ] Verify session saved to history
- [ ] Start system design interview while logged in
- [ ] Complete system design interview
- [ ] Verify session saved to history

#### Interview Sessions (Unauthenticated)
- [ ] Start algorithm interview without login
- [ ] Complete interview successfully
- [ ] Verify no history saved
- [ ] Login and check history (should be empty)

#### History Management
- [ ] View training history
- [ ] Filter by type (algorithm/system_design)
- [ ] Pagination works correctly
- [ ] View session details
- [ ] Delete session

## Deployment Notes

### Environment Variables
Add to `.env` file:
```bash
SECRET_KEY=your-secret-key-here-generate-with-openssl-rand-hex-32
```

### Database Migration
The User model will be automatically created when the application starts.
Existing databases will have the `users` table added automatically.

### Frontend Configuration
No additional configuration needed - authentication state is managed in localStorage.

## Next Steps

Future enhancements could include:
1. **Social login** (Google, GitHub OAuth)
2. **Email verification** on registration
3. **Password reset** functionality
4. **Session history export** (PDF/JSON)
5. **Training statistics dashboard**
6. **Achievement badges** and progress tracking

## Commit History

- `ca333a6` - Backend: User authentication and history persistence
- `8d9c42d` - Frontend: Authentication pages and integration

---

**Version**: 0.2.0
**Release Date**: 2025-01-25
**Status**: âœ… Complete
